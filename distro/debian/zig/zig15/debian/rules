#!/usr/bin/make -f

export HOME = $(CURDIR)
ZIG_VERSION := 0.15.2
DEB_HOST_ARCH := $(shell dpkg-architecture -qDEB_HOST_ARCH)

# Map Debian architectures to Zig architectures
ifeq ($(DEB_HOST_ARCH),amd64)
    ZIG_ARCH := x86_64
else ifeq ($(DEB_HOST_ARCH),arm64)
    ZIG_ARCH := aarch64
else
    $(error Unsupported architecture: $(DEB_HOST_ARCH))
endif

%:
	dh $@

override_dh_auto_configure:
	# Extract Zig binary for current architecture
	# With quilt format, binaries are in current directory
	tar -xJf "zig-$(ZIG_ARCH)-linux-$(ZIG_VERSION).tar.xz"

override_dh_auto_build:
	# No build needed - using official binaries

override_dh_auto_install:
	# Install to /usr/lib/zig-0.15.2/
	mkdir -p $(CURDIR)/debian/zig15/usr/lib
	mv zig-$(ZIG_ARCH)-linux-$(ZIG_VERSION) $(CURDIR)/debian/zig15/usr/lib/zig-0.15.2
	# Create versioned symlink in /usr/bin
	mkdir -p $(CURDIR)/debian/zig15/usr/bin
	ln -s ../lib/zig-0.15.2/zig $(CURDIR)/debian/zig15/usr/bin/zig-0.15

override_dh_auto_clean:
	# Don't remove the binary tarballs (*.tar.xz) from orig, only extracted dirs
	rm -rf zig-x86_64-linux-$(ZIG_VERSION) zig-aarch64-linux-$(ZIG_VERSION) zig-cache
	dh_auto_clean
